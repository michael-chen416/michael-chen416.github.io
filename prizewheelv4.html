<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seat Selection</title>
  <style>
    /* ==================== Base Styles ==================== */
    body {
      font-family: 'Georgia', serif;
      padding: 30px;
      background: radial-gradient(circle at center, #008b2c 0%, #4b0000 100%);
      color: #fff;
      margin: 0;
    }
    .confetti {
      position: fixed; top:0; width:10px; height:10px;
      opacity:0.9; animation: fall linear forwards; z-index:9999;
      border-radius:50%;
    }
    @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity:0; } }

    .screen {
        /* was: width:70%; */
        width: 100%;
        max-width: 100%;
        margin: 0 auto 20px;
        /* â€¦rest of your existing rulesâ€¦ */
    }
    .seat-grid {
        display: grid;
        /* was: grid-template-columns: auto repeat(10,40px); */
        grid-template-columns: auto repeat(10, minmax(0, 1fr));
        grid-gap: 8px;
        justify-content: center;
        align-items: center;
    }
    .seat {
        /* remove fixed width/height */
        /* was: width:40px; height:40px; */
        width: 100%;
        aspect-ratio: 1 / 1;
        /* optionally cap the size on larger screens */
        max-width: 40px;
        /* keep your existing visual rules */
        border-radius: 5px;
        background-color: #444;
        text-align: center;
        line-height: normal; /* will be overridden by flex centering below */
        cursor: pointer;
        color: white;
        user-select: none;
        border: 1px solid #777;

        /* center the number inside */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1em;
    }

    .seat.taken { background:#777; cursor:not-allowed; }
    .seat.selected { background:#0f0; }

    .legend {
      margin-top:10px; text-align:center;
    }
    .legend .box {
      display:inline-block; width:20px; height:20px;
      vertical-align:middle; margin-right:5px;
    }

    .output {
      text-align:center; margin-top:20px; font-size:18px;
    }

    .action-buttons {
      display:flex; justify-content:center; margin-top:15px; gap:10px;
      flex-wrap:wrap;
    }
    .action-buttons button {
      padding:10px 20px; font-size:16px; cursor:pointer;
      border:none; border-radius:5px; flex:1 1 auto;
    }
    /* ===== Button Size Override ===== */
    .action-buttons button {
      /* stop them stretching to fill the row */
      flex: 0 0 auto !important;
      /* a more typical padding and font */
      padding: 8px 16px !important;
      font-size: 14px !important;
      /* optional: give them a min-width so they stay consistent */
      min-width: 100px !important;
    }

    /* and for the checkout confirm/back buttons if you like */
    .checkout-buttons button {
      padding: 8px 16px !important;
      font-size: 14px !important;
      min-width: 100px;
    }

    #previewBtn  { background:#0b3d0b; color:#fff; display:none; }
    #lockInBtn   { background:gold;   color:#000; display:none; }
    #clearAllBtn { background:#ff4136; color:#fff; display:none; }
    #checkoutBtn { background:#0074D9; color:#fff; display:none; }

    /* ================= Gift Modal ================= */
    #giftModal { display:none; position:fixed; top:0; left:0;
      width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1002;
    }
    #giftModal.centered {
      display:flex; justify-content:center; align-items:center;
      flex-direction:column; text-align:center;
    }
    .giftbox {
      width:120px; height:120px; margin-bottom:20px;
      background:url('https://i.imgur.com/T8hN4fR.gif') no-repeat center/contain;
    }

    /* ================ Enhanced Checkout ================= */
    #checkoutPage {
      display:none;
      background:#1a1a1a;
      border:1px solid #444;
      border-radius:8px;
      padding:20px;
      margin:30px auto 0;
      max-width:500px;
    }
    #checkoutPage h2 {
      margin-top:0; color:#ffd700;
      text-align:center; font-size:1.6em; letter-spacing:1px;
    }
    #checkoutSummary p {
      margin:8px 0; line-height:1.4;
    }
    #checkoutSummary hr {
      border:0; border-top:1px solid #444;
      margin:12px 0;
    }
    .checkout-buttons {
      text-align:center; margin-top:20px;
    }
    .checkout-buttons button {
      padding:10px 20px; margin:0 10px;
      font-size:1em; border:none; border-radius:4px; cursor:pointer;
    }
    #confirmBtn { background:#2ECC40; color:#000; }
    #backBtn    { background:#FF4136; color:#fff; }

    /* ===== Responsive (mobile / small windows) ===== */
    @media (max-width:768px) {
      .screen { width:100%; font-size:1rem; }
      .seat-grid { grid-template-columns:auto repeat(5,1fr); grid-gap:6px; }
      .seat { width:min(40px,16vw); height:min(40px,16vw); font-size:0.9rem; }
      .action-buttons button { flex:1 1 48%; padding:8px 0; font-size:0.9rem; }
    }
    @media (max-width:480px) {
      .seat-grid { grid-template-columns:auto repeat(3,1fr); grid-gap:4px; }
      .seat { width:min(32px,22vw); height:min(32px,22vw); font-size:0.8rem; }
      .action-buttons button { flex:1 1 100%; }
    }
  </style>
</head>
<body>

  <!-- ============== SELECTION PAGE ============== -->
  <div id="selectionPage">
    <div class="screen">STAGE</div>
    <div class="seat-grid" id="seatMap"></div>

    <div class="legend">
      <span><span class="box" style="background:#444;"></span> Available</span>
      <span><span class="box" style="background:#0f0;"></span> Selected</span>
      <span><span class="box" style="background:#777;"></span> Taken</span>
    </div>

    <div class="output" id="output">No seats selected.</div>

    <div class="action-buttons">
      <button id="previewBtn"  onclick="previewSeat()">Preview</button>
      <button id="lockInBtn"   onclick="lockInSeat()">Lock In Seats</button>
      <button id="clearAllBtn" onclick="clearAll()">Clear All</button>
      <button id="checkoutBtn" onclick="showCheckout()">Checkout</button>
    </div>

    <!-- 3D Preview Modal -->
    <div id="threeModal" style="display:none; position:fixed; top:0; left:0;
         width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:1000;">
      <div style="position:relative; width:80%; max-width:800px; height:500px;
                  margin:60px auto; background:#000; border-radius:10px;
                  overflow:hidden; box-shadow:0 0 10px rgba(0,0,0,0.5);">
        <button onclick="document.getElementById('threeModal').style.display='none'"
                style="position:absolute; top:10px; right:10px; z-index:2;
                       padding:6px 12px;">Close</button>
        <canvas id="threeCanvas" style="width:100%; height:100%;"></canvas>
      </div>
    </div>

    <!-- Gift Modal -->
    <div id="giftModal">
      <div class="giftbox"></div>
      <canvas id="giftCanvas" width="300" height="300"></canvas>
      <div id="giftText" style="margin-top:20px; font-size:20px;"></div>
      <button onclick="closeGiftModal()"
              style="margin-top:20px; padding:10px 20px; border:none;
                     border-radius:5px; cursor:pointer;">Close</button>
    </div>
  </div>
  <!-- =========== /SELECTION PAGE =========== -->

  <!-- ============= CHECKOUT PAGE ============= -->
  <div id="checkoutPage">
    <h2>Order Summary</h2>
    <div id="checkoutSummary"></div>
    <div class="checkout-buttons">
      <button id="confirmBtn">Confirm Purchase</button>
      <button id="backBtn">Back</button>
    </div>
  </div>
  <!-- =========== /CHECKOUT PAGE =========== -->

  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script>
    // â€”â€” Globals & State â€”â€”  
    const seatMapEl    = document.getElementById("seatMap");
    const previewBtn   = document.getElementById("previewBtn");
    const lockInBtn    = document.getElementById("lockInBtn");
    const clearAllBtn  = document.getElementById("clearAllBtn");
    const checkoutBtn  = document.getElementById("checkoutBtn");
    const outputEl     = document.getElementById("output");

    const rows         = ['A','B','C','D','E'];
    const cols         = 10;
    const takenSeats   = ['A1','B5','C3','D8','E2'];
    const prices       = { A:150, B:150, C:100, D:100, E:60 };
    const specialSeats = { "B2":"Free Drink Voucher", "C7":"Backstage Tour Pass", "E10":"VIP Lounge Access" };

    let selectedSeats = [];
    let lockedSeatIds = [];
    let hasLockedIn   = false;

    // â€”â€” Build grid & multi-select â€”â€”  
    rows.forEach(row => {
      const rowLabel = document.createElement('div');
      rowLabel.className = 'label';
      rowLabel.textContent = row;
      seatMapEl.appendChild(rowLabel);

      for (let i = 1; i <= cols; i++) {
        const seatId = `${row}${i}`;
        const seat = document.createElement('div');
        seat.className   = 'seat';
        seat.textContent = i;
        seat.dataset.id  = seatId;
        if (takenSeats.includes(seatId)) seat.classList.add('taken');

        seat.addEventListener('click', () => {
          if (hasLockedIn) {
            alert("Youâ€™ve already locked in; no more changes allowed.");
            return;
          }
          if (!seat.classList.contains('taken')) {
            if (seat.classList.contains('selected')) {
              seat.classList.remove('selected');
              selectedSeats = selectedSeats.filter(s => s !== seat);
            } else {
              seat.classList.add('selected');
              selectedSeats.push(seat);
            }
          }
          // update UI
          if (selectedSeats.length) {
            const ids   = selectedSeats.map(s => s.dataset.id);
            const total = selectedSeats.reduce((sum, s) => sum + prices[s.dataset.id[0]], 0);
            outputEl.textContent = `Selected Seats: ${ids.join(', ')} | Total: $${total}`;
            previewBtn.style.display  = 'block';
            lockInBtn.style.display   = 'block';
            clearAllBtn.style.display = 'block';
          } else {
            outputEl.textContent = "No seats selected.";
            previewBtn.style.display  = 'none';
            lockInBtn.style.display   = 'none';
            clearAllBtn.style.display = 'none';
          }
        });

        seatMapEl.appendChild(seat);
      }
    });

    // â€”â€” 3D Preview Setup â€”â€”  
    let renderer, scene, camera, seats3D = [];
    function initThreeJS() {
      const canvas = document.getElementById("threeCanvas");
      const rect   = canvas.parentElement.getBoundingClientRect();
      renderer = new THREE.WebGLRenderer({ canvas });
      renderer.setSize(rect.width, rect.height);
      renderer.setPixelRatio(window.devicePixelRatio);

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x111111);

      camera = new THREE.PerspectiveCamera(60, rect.width/rect.height, 0.1, 1000);
      camera.position.set(0,5,20);

      const light = new THREE.DirectionalLight(0xffffff,1);
      light.position.set(10,10,10);
      scene.add(light, new THREE.AmbientLight(0x404040));

      const stage = new THREE.Mesh(
        new THREE.BoxGeometry(10,5,0.5),
        new THREE.MeshStandardMaterial({ color: 0xff5555 })
      );
      stage.position.set(0,2.5,-20);
      scene.add(stage);

      rows.forEach((r, ri) => {
        for (let c = 1; c <= cols; c++) {
          const s = new THREE.Mesh(
            new THREE.BoxGeometry(0.5,0.5,0.5),
            new THREE.MeshStandardMaterial({ color: 0x4444ff })
          );
          s.position.set((c - cols/2)*1.2, 0.25, ri*1.2);
          s.name = `${r}${c}`;
          scene.add(s);
          seats3D.push(s);
        }
      });

      animate();
    }
    function animate() {
      requestAnimationFrame(animate);
      if (renderer && scene && camera) renderer.render(scene, camera);
    }

    // â€”â€” Preview Last Seat â€”â€”  
    function previewSeat() {
      if (!selectedSeats.length && !lockedSeatIds.length) {
        alert("No seat selected to preview.");
        return;
      }
      const lastId = hasLockedIn
        ? lockedSeatIds[lockedSeatIds.length - 1]
        : selectedSeats[selectedSeats.length - 1].dataset.id;

      document.getElementById('threeModal').style.display = 'block';
      if (!renderer) initThreeJS();

      seats3D.forEach(s => {
        s.material.color.set(s.name === lastId ? 0x00ff00 : 0x4444ff);
      });

      const target = seats3D.find(s => s.name === lastId);
      if (target) {
        camera.position.set(target.position.x, target.position.y+1.2, target.position.z+1.5);
        camera.lookAt(0,2.5,-20);
      }
    }

    // â€”â€” Clear All â€”â€”  
    function clearAll() {
      selectedSeats.forEach(s => s.classList.remove('selected'));
      selectedSeats = [];
      outputEl.textContent = "No seats selected.";
      previewBtn.style.display  = 'none';
      lockInBtn.style.display   = 'none';
      clearAllBtn.style.display = 'none';
    }

    // â€”â€” Lock In & Enable Checkout â€”â€”  
    function lockInSeat() {
      if (!selectedSeats.length || hasLockedIn) return;
      const ids   = selectedSeats.map(s => s.dataset.id);
      const total = ids.reduce((sum,id) => sum + prices[id[0]], 0);

      selectedSeats.forEach(s => {
        const id = s.dataset.id;
        if (specialSeats[id]) { showGiftModal(specialSeats[id]); launchConfetti(); }
        s.classList.add('taken');
        s.classList.remove('selected');
      });

      lockedSeatIds = ids.slice();
      hasLockedIn   = true;
      outputEl.textContent      = `Locked in: ${ids.join(', ')} | Total: $${total}`;
      lockInBtn.style.display   = 'none';
      clearAllBtn.style.display = 'none';
      previewBtn.style.display  = 'block';
      checkoutBtn.style.display = 'block';
    }

    // â€”â€” Enhanced Checkout Flow â€”â€”  
    function generateOrderNumber() {
      return 'ORD' + Math.floor(100000 + Math.random()*900000);
    }
    function showCheckout() {
      document.getElementById('selectionPage').style.display = 'none';
      const sumEl = document.getElementById('checkoutSummary');

      const orderNum     = generateOrderNumber();
      const purchaseDT   = new Date().toLocaleString();
      const eventDetails = 'Live Concert â€“ March 15, 2026 @ 7:00 PM';
      const customerEmail= 'johndoe@example.com';
      const customerPhone= '(555) 123-4567';
      const seatsList    = lockedSeatIds.join(', ');
      const totalAmt     = lockedSeatIds.reduce((sum,id) => sum + prices[id[0]], 0);

      sumEl.innerHTML = `
        <p><strong>Order #:</strong> ${orderNum}</p>
        <p><strong>Purchase Date:</strong> ${purchaseDT}</p>
        <p><strong>Email:</strong> ${customerEmail}</p>
        <p><strong>Phone:</strong> ${customerPhone}</p>
        <hr>
        <p><strong>Event:</strong> ${eventDetails}</p>
        <p><strong>Seats:</strong> ${seatsList}</p>
        <p><strong>Total:</strong> $${totalAmt.toFixed(2)}</p>
      `;
      document.getElementById('checkoutPage').style.display = 'block';
    }
    function cancelCheckout() {
      document.getElementById('checkoutPage').style.display   = 'none';
      document.getElementById('selectionPage').style.display = 'block';
    }
    document.getElementById('confirmBtn').addEventListener('click', () => {
      alert('Purchase confirmed! Thank you for your order ðŸ˜Š');
      window.location.reload();
    });
    document.getElementById('backBtn').addEventListener('click', cancelCheckout);

    // â€”â€” Gift Modal & Confetti â€”â€”  
    let giftRenderer, giftScene, giftCamera, lidGroup, sparkles = [];
    let openAngle = 0, sparkleStartTime = null;
    function initGiftBox() {
      const canvas = document.getElementById("giftCanvas");
      giftRenderer = new THREE.WebGLRenderer({ canvas, alpha: true });
      giftRenderer.setSize(300,300);
      giftRenderer.setPixelRatio(window.devicePixelRatio);
      giftScene = new THREE.Scene();
      giftCamera = new THREE.PerspectiveCamera(45,1,0.1,1000);
      giftCamera.position.set(0,2.5,5); giftCamera.lookAt(0,0.5,0);
      const dl = new THREE.DirectionalLight(0xffffff,1);
      dl.position.set(3,5,2);
      giftScene.add(dl, new THREE.AmbientLight(0x808080));
      const redMat  = new THREE.MeshStandardMaterial({ color:0xff5555 });
      const goldMat = new THREE.MeshStandardMaterial({ color:0xffd700 });
      // Box base and walls
      const bw=2, bh=1.5, bd=2, wt=0.1, by=-bh/2;
      const bottom = new THREE.Mesh(new THREE.BoxGeometry(bw,wt,bd), redMat);
      bottom.position.y = by*2; giftScene.add(bottom);
      [['back',[0,by,-bd/2+wt/2]], ['front',[0,by,bd/2-wt/2]],
       ['left',[-bw/2+wt/2,by,0]], ['right',[bw/2-wt/2,by,0]]]
      .forEach(([_,pos]) => {
        const geo = (_==='back'||_==='front')
          ? new THREE.BoxGeometry(bw,bh,wt)
          : new THREE.BoxGeometry(wt,bh,bd);
        const m = new THREE.Mesh(geo, redMat);
        m.position.set(...pos); giftScene.add(m);
      });
      // Ribbons
      [[0,by,bd/2-wt/2],[0,by,-bd/2+wt/2]].forEach(pos=>{
        const r = new THREE.Mesh(new THREE.BoxGeometry(0.2,bh,wt), goldMat);
        r.position.set(...pos); giftScene.add(r);
      });
      [[bw/2-wt/2,by,0],[-bw/2+wt/2,by,0]].forEach(pos=>{
        const r = new THREE.Mesh(new THREE.BoxGeometry(wt,bh,0.2), goldMat);
        r.position.set(...pos); giftScene.add(r);
      });
      // Lid
      lidGroup = new THREE.Group();
      lidGroup.position.set(0,0,-1);
      const lidBox = new THREE.Mesh(new THREE.BoxGeometry(2.1,0.3,2.1), redMat);
      lidBox.position.set(0,0.15,1);
      const lr1 = new THREE.Mesh(new THREE.BoxGeometry(0.2,0.3,2.1), goldMat);
      const lr2 = new THREE.Mesh(new THREE.BoxGeometry(2.1,0.3,0.2), goldMat);
      lr1.position.set(0,0.25,1); lr2.position.set(0,0.25,1);
      lidGroup.add(lidBox, lr1, lr2);
      giftScene.add(lidGroup);
      // Sparkles
      const geo = new THREE.BufferGeometry();
      const posArr = new Float32Array(200*3), velArr = [];
      for (let i=0; i<200; i++){
        posArr[i*3]   = (Math.random()-0.5)*1.2;
        posArr[i*3+1] = Math.random()*3;
        posArr[i*3+2] = (Math.random()-0.5)*1.2;
        velArr.push((Math.random()-0.5)*0.02, 0.02+Math.random()*0.03, (Math.random()-0.5)*0.02);
      }
      geo.setAttribute('position', new THREE.BufferAttribute(posArr,3));
      geo.setAttribute('velocity', new THREE.BufferAttribute(new Float32Array(velArr),3));
      const mat = new THREE.PointsMaterial({ color:0xffffff, size:0.2,
        blending:THREE.AdditiveBlending, depthWrite:false, transparent:true, opacity:1 });
      const pts = new THREE.Points(geo, mat);
      pts.position.y = 1.2; giftScene.add(pts); sparkles.push(pts);
      openAngle = 0; sparkleStartTime = null;
      animateGiftBox();
    }
    function animateGiftBox(ts) {
      requestAnimationFrame(animateGiftBox);
      if (openAngle < Math.PI/2) {
        openAngle += 0.02; lidGroup.rotation.x = -openAngle;
      }
      if (sparkles.length && sparkleStartTime===null) sparkleStartTime = ts;
      if (sparkles.length && sparkleStartTime!==null) {
        const elapsed = (ts - sparkleStartTime)/1000;
        const pa = sparkles[0].geometry.getAttribute('position');
        const va = sparkles[0].geometry.getAttribute('velocity');
        for (let i=0; i<pa.count; i++){
          pa.array[i*3]   += va.array[i*3];
          pa.array[i*3+1] += va.array[i*3+1];
          pa.array[i*3+2] += va.array[i*3+2];
        }
        pa.needsUpdate = true;
        sparkles[0].material.opacity = Math.max(0, 1 - elapsed*0.3);
      }
      giftRenderer.render(giftScene, giftCamera);
    }
    function showGiftModal(prize) {
      const gm = document.getElementById('giftModal');
      gm.classList.add('centered');
      document.getElementById('giftText').innerText = `ðŸŽ You won: ${prize}!`;
      initGiftBox();
    }
    function closeGiftModal() {
      document.getElementById('giftModal').classList.remove('centered');
    }
    function launchConfetti() {
      const colors = ['#ff7e5f','#feb47b','#86e3ce','#d0e6a5','#f5d491','#ffaaa5'];
      for (let i=0; i<80; i++){
        const c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = Math.random()*100+'vw';
        c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
        c.style.animationDuration = (2+Math.random()*2)+'s';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(), 4000);
      }
    }
  </script>
</body>
</html>
